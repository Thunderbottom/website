---
import { getCollection } from "astro:content";
import PageLayout from "@layouts/PageLayout.astro";
import Container from "@components/Container.astro";
import FormattedDate from "@components/FormattedDate.astro";
import BackToPrev from "@components/BackToPrev.astro";
import Message from "@components/Message.astro";
import Sidenote from "@components/Sidenote.astro";

export const prerender = true;

export async function getStaticPaths() {
  const blogEntries = await getCollection("blog", ({ data }) => {
    return !data.draft;
  });

  return blogEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content, headings, remarkPluginFrontmatter } = await entry.render();

const readingTime = remarkPluginFrontmatter?.minutesRead || "1 min read";

const components = {
  Message,
  Sidenote,
};
---

<PageLayout
  title={entry.data.title}
  description={entry.data.description || entry.data.summary}
  currentPath={`/blog/${entry.slug}/`}
  ogType="article"
>
  <Container>
    <div class="space-y-8">
      <div>
        <BackToPrev href="/blog"> Back to blog </BackToPrev>
      </div>

      <div class="space-y-4">
        <div
          class="flex items-center gap-2 text-sm text-text-secondary dark:text-text-secondary-dark"
        >
          <FormattedDate date={entry.data.date} format="%B %d, %Y" />
          <span>•</span>
          <span>{readingTime}</span>
          {
            entry.data.last_modified_at && (
              <>
                <span>•</span>
                <span>
                  Updated:{" "}
                  <FormattedDate
                    date={entry.data.last_modified_at}
                    format="%B %d, %Y"
                  />
                </span>
              </>
            )
          }
        </div>

        <div>
          <h1
            class="font-display text-3xl font-semibold leading-tight text-text-primary"
          >
            {entry.data.title}
          </h1>
        </div>
      </div>

      <article class="prose prose-lg max-w-none">
        <Content components={components} />
      </article>

      <div class="border-t border-border pt-8 text-center">
        <p class="text-lg italic text-text-secondary text-text-secondary-dark">
          Got any questions or comments, or just want to say hello?<br />Drop by
          on my email!
        </p>
      </div>
    </div>
  </Container>
</PageLayout>
