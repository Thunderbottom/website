@tailwind base;
@tailwind components;
@tailwind utilities;

html {
  overflow-y: scroll;
  color-scheme: light;
}

html.dark {
  color-scheme: dark;
}

html,
body {
  @apply size-full;
}

body {
  @apply font-serif antialiased;
  @apply flex flex-col;
  @apply bg-background dark:bg-background-dark;
  @apply text-text-primary dark:text-text-primary-dark;
  @apply transition-colors duration-200;
  font-size: 1.25rem;
  line-height: 1.7;
}

header {
  @apply fixed top-0 left-0 right-0 z-50 py-5;
  @apply bg-background/90 dark:bg-background-dark/90;
  @apply backdrop-blur-sm;
  @apply border-b border-border/30 dark:border-border-dark/30;
}

main {
  @apply flex-1 pt-32 pb-16;
}

footer {
  @apply py-5 text-sm;
}

/* ===== HEADINGS ===== */
h1,
h2,
h3,
h4,
h5,
h6 {
  @apply text-text-primary dark:text-text-primary-dark;
  @apply font-display font-semibold;
}

/* ===== PROSE CUSTOMIZATION ===== */
article {
  @apply max-w-full prose prose-lg dark:prose-invert;
  @apply prose-headings:font-display prose-headings:font-semibold;
  @apply prose-headings:text-text-primary dark:prose-headings:text-text-primary-dark;
  @apply prose-p:font-serif prose-p:text-text-primary dark:prose-p:text-text-primary-dark;
  @apply prose-a:text-link dark:prose-a:text-link-dark prose-a:no-underline prose-a:border-b prose-a:border-link dark:prose-a:border-link-dark;
  @apply prose-code:font-mono prose-code:text-red-600 dark:prose-code:text-red-400;
  @apply prose-pre:font-mono;
  @apply prose-strong:text-text-primary dark:prose-strong:text-text-primary-dark;
}

@layer utilities {
  article a:hover,
  .prose a:hover {
    @apply bg-link-hover dark:bg-link-hover-dark text-text-primary dark:text-text-primary-dark border-text-primary dark:border-text-primary-dark;
  }

  /* Ensure all interactive elements have sufficient contrast */
  .text-secondary {
    @apply text-text-secondary dark:text-text-secondary-dark;
  }

  .text-muted {
    @apply text-text-muted dark:text-text-muted-dark;
  }

  /* Override any low-contrast utility classes */
  .text-gray-500 {
    @apply text-text-secondary dark:text-text-secondary-dark;
  }

  .text-gray-400 {
    @apply text-text-muted dark:text-text-muted-dark;
  }
}

/* ===== SHIKI THEME SWITCHING ===== */
@layer base {
  /* Light theme (default) */
  pre code,
  pre code span {
    color: var(--shiki-light, inherit) !important;
    background-color: var(--shiki-light-bg, transparent) !important;
    font-style: var(--shiki-light-font-style, inherit) !important;
    font-weight: var(--shiki-light-font-weight, inherit) !important;
    text-decoration: var(--shiki-light-text-decoration, inherit) !important;
  }

  /* Dark theme */
  html.dark pre code,
  html.dark pre code span {
    color: var(--shiki-dark, inherit) !important;
    background-color: var(--shiki-dark-bg, transparent) !important;
    font-style: var(--shiki-dark-font-style, inherit) !important;
    font-weight: var(--shiki-dark-font-weight, inherit) !important;
    text-decoration: var(--shiki-dark-text-decoration, inherit) !important;
  }

  /* Pre backgrounds */
  pre {
    background-color: var(--shiki-light-bg, #f8fafc) !important;
  }

  html.dark pre {
    background-color: var(--shiki-dark-bg, #0f172a) !important;
  }
}

/* ===== ANIMATIONS ===== */
.animate {
  @apply opacity-0 translate-y-3;
  @apply transition-all duration-700 ease-out;
}

.animate.show {
  @apply opacity-100 translate-y-0;
}

html #back-to-top {
  @apply opacity-0 pointer-events-none;
}

html.scrolled #back-to-top {
  @apply opacity-100 pointer-events-auto;
}

/* ===== TUFTE-STYLE SIDENOTES ===== */
.sidenote,
.marginnote {
  float: right;
  clear: right;
  margin-right: -35%;
  width: 30%;
  margin-top: 0;
  margin-bottom: 0.5rem;
  font-size: 1rem;
  line-height: 1.7;
  vertical-align: baseline;
  position: relative;
  @apply text-text-secondary dark:text-text-secondary-dark;
  font-style: italic;
  padding-left: 0.5rem;
  @apply border-l border-border dark:border-border-dark;
}

/* Mobile sidenotes */
@media (max-width: 42rem) {
  .sidenote,
  .marginnote {
    float: none;
    display: none;
    width: 95%;
    margin: 1rem 0;
    padding: 0.5rem;
    @apply border-l-2 border-border dark:border-border-dark;
    font-size: 0.85rem;
  }

  .sidenote.active,
  .marginnote.active {
    display: block;
  }
}

.sidenote-number::after {
  content: attr(data-footnote-id);
  font-size: 0.85rem;
  position: relative;
  vertical-align: super;
  font-weight: bold;
  top: -0.25em;
  @apply text-link dark:text-link-dark;
}

.sidenote .sidenote-number::after {
  content: attr(data-footnote-id) ". ";
  font-size: 0.85rem;
  position: relative;
  vertical-align: baseline;
  font-weight: bold;
  top: 0;
  @apply text-link dark:text-link-dark;
}

article,
.post {
  counter-reset: sidenote-counter;
}

label.margin-toggle.sidenote-ref {
  @apply text-link dark:text-link-dark;
  font-size: 0.75rem;
  vertical-align: super;
  position: relative;
  font-weight: 600; /* Make it bolder for better contrast */
}

.sidenote-toggle,
.margin-toggle {
  display: none;
}

/* Mobile sidenote toggles */
@media (max-width: 42rem) {
  .sidenote-ref,
  label.margin-toggle.sidenote-ref {
    display: inline;
    cursor: pointer;
    font-size: 0.85rem;
    position: relative;
    font-weight: 600; /* Better contrast */
  }

  .margin-toggle:checked + .sidenote,
  .margin-toggle:checked + .marginnote,
  .sidenote-toggle:checked + .sidenote {
    display: block;
    float: left;
    left: 0;
    clear: both;
    width: 95%;
    margin: 1rem 2.5%;
    position: relative;
    padding: 0.5rem;
    @apply border-l-2 border-border dark:border-border-dark;
    font-size: 0.85rem;
  }

  .sidenote-ref:after {
    content: "âŠ•";
    @apply text-link dark:text-link-dark;
    font-weight: 700; /* Bolder for better contrast */
  }

  label.margin-toggle.sidenote-ref,
  .sidenote-ref {
    margin: 0 0.2em;
    padding: 0;
    line-height: 1;
  }
}

/* ===== MESSAGE COMPONENTS ===== */
.message-title {
  @apply font-display font-bold mt-0 mb-2;
  @apply text-text-primary dark:text-text-primary-dark; /* Ensure high contrast */
}

.message-content p:last-child {
  @apply mb-0;
}

.message > *:first-child {
  @apply mt-0 !important;
}

/* ===== RESPONSIVE ADJUSTMENTS ===== */
@media (max-width: 42rem) {
  body {
    font-size: 1.125rem;
  }

  article {
    @apply prose-base;
  }
}

/* ===== FOCUS STYLES FOR ACCESSIBILITY ===== */
@layer utilities {
  .focus-visible\:ring-2:focus-visible {
    @apply ring-2 ring-link dark:ring-link-dark ring-offset-2 ring-offset-background dark:ring-offset-background-dark;
  }

  button:focus-visible,
  a:focus-visible,
  input:focus-visible,
  textarea:focus-visible {
    @apply outline-none ring-2 ring-link dark:ring-link-dark ring-offset-2 ring-offset-background dark:ring-offset-background-dark;
  }
}
